{% extends "launchpad/layout.html" %} 
{% load rest_framework %}
{% load static %}{% load i18n %}

{% block content %}
<!-- Bootstrap core CSS -->
<link href="{% static "jetway/leafletjs/leaflet.css" %}" rel="stylesheet">    
<script src="{% static "jetway/leafletjs/leaflet.js" %}"  type="text/javascript"></script>


<div>
<h1>Flight Plan Detail - {{ flightplan.name }}</h1>
<br>
<br>
<table  class="table">
    <thead>
        <tr>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tr>
        <td>GeoJSON</td>
        <td><div id="flight_plan" class="map"></div></td>    
    </tr>
    <tr>
        <td>Start</td>
        <td>{{ flightplan.start_datetime}}</td>
    </tr>
    <tr>
        <td>End</td>
        <td>{{flightplan.end_datetime}}</td>
    </tr>

</table>
<br>
{% if flightplan.is_editable %}
    <p><a class="btn btn-primary" href="/launchpad/flightplans/{{flightplan.id}}"><b>Update Details</b></a></p>
    {% else %}
    
    <p class='text-muted'>The operation against this plan is signed and cannot be edited, create a new plan to update it.</p>
    {% endif %}
    

</div>
<script type="text/javascript">
    var map = L.map('flight_plan', {zoomControl: false,   doubleClickZoom: false, 
        closePopupOnClick: false, 
        dragging: false, 
        trackResize: false,
        touchZoom: false,
        scrollWheelZoom: false});
    var fg = L.featureGroup().addTo(map);
    let geo_json = JSON.parse('{{ flightplan.geo_json|safe }}');
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    
    L.geoJSON(geo_json).addTo(fg);
    map.fitBounds(fg.getBounds());

</script>

{% endblock %}